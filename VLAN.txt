如何分割网络,需要使用什么样的设备？

	一个园区网中用的最多的设备是交换机，接入层是交换机，汇聚层也是交换机，甚至核心层我们也用交换机。
	汇聚层和核心层用的是 MLS 多层交换机，接入用的是纯 L2 层交换机。
	
	Layer 2 Switch 交换机负责通过网络线缆将主机连接入网，并通过查看 CAM 表中存的 DMAC 目的MAC地址 对数据 做网络内的数据转发，
	CAM 表 3元组 主机的 MAC 地址，主机 连接 交换机 的 Port(接口)， Port(接口)所属的 VLAN。
	
	交换机会自动学习 单播的 CAM 表的地址表项，表项是基于 接收 发送者 1 个帧的 2 层 原MAC 地址学习的。
	收到 组播 和 广播 进行泛洪转发，交换机是无法分割网络的。
	
	一个网络中主机建议不超过 300 台，ARP 的广播报文会影响整体的网络效率。
	一端的主机通过 ARP 协议，解析网络内 对端 主机的 MAC 地址，作为 封装帧的目的 MAC 地址。

经典网络分割 
	
	SW1---Router---SW2 

	路由器 Router 成本比较高，比如 VPN，Port(接口)较少；路由器转发数据是查路由表，需要消耗 CPU 和内存。
	而且它是用 DIP 和 路由表中每一行 路由表项 的子网掩码做与运算，再和 路由表项中 的 网络号 去匹配，属于模糊匹配。
	路由表项是指向的一个一个网络，而不是一个一个主机。
	
	交换机是通过对比 CAM 表的 MAC 地址做精确转发。用 ASIC 芯片表应用交换集成电路，属于硬件转发 48 bit 的 MAC 地址。

VLAN 是什么？

	VLAN 是一个在 2 层交换机上实现网络隔离的技术，用来 分割广播域，而无需借助 3 层路由器。使用 VLAN 以后交换机还个是 2 层设备。
	
VLAN 怎么使用？

	先在交换机上创建多个 VLAN，再把 不同 Port(接口)以 Group(组)的形式 和 不同的 VLAN 做一个(Bind)绑定。
	VLAN A 的主机 Port(接口)无法 和 VLAN B 的 Port(接口)进行网络内通信。

静态 VLAN 部署
	
	端到端 VLAN 本地 VLAN
	
动态 VLAN 部署

	拿主机的 MAC 地址 和 内网一台 Server，那些 MAC 地址 对应那些 VLAN，交换机 Port(接口)一概 不和 VLAN 关联。
	主机 和 交换机通过一根网线完成连接，交换机 收到 主机 发送的数据帧，拿到 主机的 MAC 地址。
	交换机 拿这个 主机的 MAC 地址后，向服务器询问此 MAC 地址属于那个 VLAN。交换机知道了这个数据帧属于 VLAN 10 再做数据转发。
	转发数据的时候主机默认只能访问 VLAN 10 内的所有主机。
	
	端到端 VLAN

	1.创建我们所需要使用的 VLAN FLASH 保存 vlan.database vlan.dat
	2.将创建出来的 VLAN 关联到 交换机 的相应接口。
	
	VLAN 编号是 1-4094，1-1005 标准 VLAN，以后的叫扩展 VLAN。 
	其中编号为 1 的叫做 Default VLAN，如果不做 VLAN 设置默认交换机所有接口都属于 Default VLAN，本征 VLAN。
	还有 1002-1005 不应用于 Ethernet(以太网)。
	扩展 VLAN 对 VTP(valan中继协议)是有要求的。VTP3 可以用标准扩展，VTP1，VTP2。

 
	在交换机 SW1 上创建 VLAN 10 和 VLAN 20，
	将交换机 1-12 Port(接口)关联到 VLAN 10，逻辑交换机为的 1 VLAN 中。
	将交换机 13-24 Port(接口)关联到 VLAN 20，逻辑交换机为的 2 VLAN 中。
	前 12 个 Port(接口)连接的主机 不能访问后 12 个 Port(接口)连接的 主机。

	MLS 多层交换机 通过 SVI(Switch VLAN Interface) 虚拟接口/逻辑接口，来作为一个 VLAN 组内的所有主机的网关接口。
	Interface vlan1 这个接口属于 vlan1 , 这个接口 可以 和该 VLAN 内的 主机 通信。
	对于多层交换机而言，创建一个 VLAN 的 SVI，是希望这个 SVI 接口来做该 VLAN 所有成员的网关接口。

	2层的 SVI 作用，可以配一个 IP 地址，Telnet SSH 远程登陆交换机。

VxLAN 虚拟扩展局域网

	一个部门创建一个 VLAN

交换机接口有那些类型？
	
	级联接口，数量很少
	下联接口，数量是级联接口的10倍

交换机接口模式？
	
	Access 接入模式：交换机连接 PC，服务器，路由器，打印机使用 Access， 一个接入接口(port) 只能关联一个 VlAN，交换机只会把 接入的数据 转发到 本VLAN内 的主机上。
	
		.interface Enternet 0/0
		.switchport mode access 		# 将接口状态设置为接入模式。
		.switchport access vlan10 	# 将该接口和 vlan10 进行关联

	Trunk 中继模式：交换机之间互联的时候使用 Trunk 接口

	SW1---中继接口----SW2
	10	 	 		10
	20       			20
	30       			30

	交换机 通过一个 接口 收到一个数据帧，如果这个 接口 是一个 Access 接入接口，交换机怎么知道这个数据是属于那个 VLAN？
	原因是你的接口 和 VLAN 关联并且只关联一个 VLAN，交换机 通过这个 接入接口 收到数据帧 自然就知道数据 是 那个 VLAN。
	
	但是 Trunk 中继链路不一样，中继接口没有关联任何一个 VLAN。任何通过中继接口的 VLAN 流量都应该能正常通过，才能保证通信。
	
	交换机 SW1 收到不同 VLAN 主机发送的流量并转发时，怎样区分不同 VLAN 内的流量 SW1 是知道的，那 SW2 是怎么知道的？
	
	SW2 通过 中继接口 收到一个帧，如果不能判断它是来自那个 VLAN 的，怎么针对这个原 MAC 地址进行 MAC 地址表项的学习，怎么通过目的 MAC 地址进行精确数据转发呢？
	没办法，很尴尬，为了避免这种情况。
	SW1 在转发送数据前 给数据帧 再封装一个层标记 VLAN ID，SW2 收到数据帧之后通过查看标记就知道这个数据属于那个 VLAN 了。
	这个时候再进行 MAC 地址表项学习的时候，就可以将学到的表项 添加到对应的 VLAN 中去，再进行该 VLAN 内的转发。
	
	SW1 打VLAN 标签的时候用到两个协议 CLS 是 cisco 私有协议，一个是 IEEE 802.1Q 公有协议。
	在 Ethernet 帧头的 Type 字段之前添加一个 4 Btye 的标记，包含一个12 bit VLAN-ID，来区分数据来自那个 VLAN。
	被封装的帧叫做 802.1Q 帧，这个帧只有交换机能识别，PC，路由器，服务器他们都不能识别。
	
	PC 在发送接收数据帧的时候，只认 标准的 Ethernet 以太网帧，它根本就不知道自己属于那个 VLAN。
	永远 不要指望 PC 在发送数据的时候 直接 携带一个携带 VLAN-Id 的数据帧。
	因此，在中继链路上，打标这个事情，肯定是由交换机来做，发送方交换机打标，接受方交换机知道属于那个 WLAN 后会把这个标记去掉，再转发。


