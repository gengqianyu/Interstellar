PPP的原理以及配置
咱们早期的网络确实是分为广域网和局域网的。
局域网的典型：Enternet， Token Ring，FDDI等
广域网的典型：HDLC，PPP，Frame Relay。
之所以，以前网络分为局域网和广域网。第一是他们分布的位置，局域网一般存在于咱们企业的内部。企业园区的内网，一般使用局域网协议，来构建网络。
每个园区会有一个边界，早期的边界咱们使用路由器，路由器这一类设备，路由器即能支持局域网线缆连接，又能支持广域网线缆连接。这些协议它都能支持。
所以它作为边界可以通过局域网线缆连接内网，又可以通过广域网线缆连接运营商公网，早期企业园区到运营商之间，使用广域网线缆。称为Serial 串行线缆，连接串行接口。
通过铜轴线缆，或者双绞线，只支持短距离的数据传输，拿一根局域网线缆做一个网络连接，你注定就连不长。
相反这种广域网协议，使用的serial线缆，虽有不同但是普遍支持的传输距离较长。所以广域网的支持的范围要比局域网大很多。

企业园区边界连接运营商，这一段连接的长度还是有保障的，为了保障线缆支持长距离传输，一般这一段使用serial线缆。
但是如今来看局域网和广域网就不挂在嘴边了，直接说网络或者广播域。
因为现在的Enternet协议做了一系列的升级，支持了单模光纤，支持的传输距离要比serial线缆支持的传输距离要多的多。支持1000公里，
Enternet支持的带宽又高，现在支持千兆万兆，serial线缆支持的带宽是非常低的。因此现在不管是内网还是外网连接，我们清一色使用光纤。

并且你不使用Serial线，你的边界设备就没有必要使用路由器了，可以用安全性更好的防火墙。
也不是说路由器就淘汰了，路由器可以使用在DMZ区域，来承载 lian to lian的IPsec VPN，防火墙来作为边界增加从外到内的网络访问安全性。

在光纤上能不能使用PPP和HDLC
首先局域网线，和广域网线是有很大区别的，就拿局域网的以太网协议来说吧，以太网所支持的线缆叫双绞线，光纤，同轴电缆。这些线缆是不支持token ring，FDDI协议的。
一般这些局域网线缆开发出来只规定一个协议。广域网线缆就不一样了，它是可编程的你希望它能使用HDLC，PPP，Frame relay这些协议都能用。
在局域网中线缆对协议是多对一的关系，而广域网中线缆对协议是一对多，所以光纤是不能用在广域网协议PPP和HDLC上的。

ppp有什么了不起，早期运营商只要你使用serial线缆把一个企业网连接到运营商。一般在这个serial线缆上一般跑的就是ppp协议点到点协议。
它能支持链路协商，客户网络的接口是不用配地址的，运营商那边配好地址以后，客户开始发起PPP的链路协商。
在协商的第三个阶段，我能够通过ipcp来请求运营商端，给客户端自动分配一个IP地址。并且分配完ip地址以后，客户端会产生一条默认路由，指向运营商端。方便内网到公网的访问。
第一你能轻松获得地址，第二你能获得路由条目。

ppp的链路建立会分为三个阶段，第一个阶段是物理层和数据链路层的协商，第二个阶段是一个链路级认证，
请注意，无论是局域网协议还是广域网协议，能够基于这个协议自身来实现链路间认证的。ppp是唯一的一款。所有的局域网协议都做不到。所有其他的广域网协议也做不到。唯独ppp能做到。
你在使用ppp的时候，运营商端可以要求客户端，在建立连接的同时请你出示一个用户名密码，你出示的用户名密码正确，我就把链路给你弄起来，如果用户名密码不正确，会把链路关闭。
可以通过认证，来让客户端增加一个准入限制性条件，接下来你可以把这个链路层的认证结合AAA做一个认证授权审计。也就说电信给企业办一个宽带，办好宽带之后。
帮你把猫调好，线缆链好，但是缴费可能按月，按年交，如果某一天客户没有缴费，我就可以让你的账号失效，连接就会断开。我也可以根据的授权，给你做一个链路限速。
还可以通过审计来给你做一个计费，看你本月用多少流量，都能给你做一个统计。这就是所谓的AAA，AAA应用是比较普及的，但是能脱离AAA自身就能支持认证的协议，ppp是唯一的一款。
广域网协议的好处就是能辅助运营商来实现咱们的业务。

ppp是一个纯粹的公有协议，HDLC是有厂商标准的，设备需要调试。

P2P经典的网络连接。两个节点之间连一根线，通常使用的广域网协议HDLC和PPP协议。
在广域网环境中也能实现NBMA网络不支持广播，使用的Frame Relay协议。
现在的广域网基本都被淘汰了，不管是ppp还是HDLC都已经被淘汰了。当前见的最多的就是Enternet连接。Enternet中的光纤链路太优秀了，支持的带宽和距离碾压所有其他协议。
但是Enternet有一个最大的问题就是不支持协商。你不能说咱们一端的接口有地址，另外的一个端口通过协商获得一个地址，并且指定两外一个接口做默认网关，是做不到的，
以上这些可以通过手动配或者DHCP服务，默认路由通过DHCP给你发送一个默认网关，也能实现，但是有一点不能忍，就是以太网网络链路一旦连接了，没有任何准入机制。
没有任何办法提供二层的认证。一旦线连了这个网就通了，运营商肯定是不愿意的，没办法收钱肯定不行。即使使用Enternet网络连接我也希望你出示用户名密码，那怎么办呢。
只能强行在广域网以太网连接基础之上，去虚拟出一个广域网PPP这么一个连接。这个协议就是PPPoE。PPP over Enternet叫承载在以太网之上的ppp协议。
底层连接依然是以太网连接，但是我在你以太网两个节点之间，我给你虚拟出这么一段PPP连接。通这段ppp连接来做链路层协商，让运营商网通过ppp的协商就能给你自动产生一个地址。
拿到地址的这一端，就能产生一条默认路由，指向发地址的那一端服务器，并且使用PPP协议所自带的链路层认证，在PPPoE中也可以做。
现在无论是个人，学校，企业网宽带都看不到广域网连接了，由于没有了广域网连接，所以路由器也就没必要做企业园区的边界了。可以用防火墙。
紧着着你通过以太网线，通上光纤连到运营商，一般是光纤先连一个猫，再由猫连接运营商局域端设备，做一个拨号上网，这个拨号就是PPPoE。
通过PPPoE，边界设备可以拿地址，指网关。只要能出示正确的用户名密码，你这个连接就能正常使用了。

ppp协议伞包括：
	LCP链路控制协议 第一阶段  链路层协商，建立，拆除，监控PPP数据链路。
	PAP 密码认证协议 第二阶段 链路层认证 主认证方要求对方出示认证用户名密码，明文方式做认证，只要有黑客被抓包。
	CHAP 挑战握手认证协议 MD5密文认证，因为有一个随机数，所以你不用担心，重放攻击，中间人攻击。三次握手认证，主认证方给被认证方发送一个challenge，被认证方给主认证方发送用户名密码。
	主认证方收到做验证，通过做一个回包。
	NCP 网络控制协议 IPv4CP IPv6CP IPXCP 第三阶段，NCP协商，IPv4CP协商两端接口地址，如果对端没有地址，服务方通过IPXCP给对方分配一个地址，并且产生默认路由指向发送端。
	只要两端地址不冲突就ok了。
	
注意广域网不要求通信两端IP地址在同一个网段：一端是10.0.0.1 另一端是20.0.0.1是可以的。通过Peer-neighbor route对等体邻居路由实现。
一方给对方推送一个20.0.0.1/32，一方给对方10.0.0.1/32路由实现访问，IPCP这个协议会把各自端的ip地址以32位主机路由的形式推送给对端。

国内认证都是PAP，国外都用CHAP。

主认证方向被认证方发送一个challenge报文，challenge报文中会包含一个会话ID，会话ID用来标识报文交互的。为给你发一个会话id是10，对方给返回response的时候会话id也是10.
如果不是10，我是不接收的，思科会周期做challenge，会话id每次都会变。并且会话id越来越大，challenge报文中还会有一个随机数，用于防备黑客重放攻击。

所谓的重放攻击是什么意思呢，我给你发送一个challenge报文，黑客把这个challenge抓取了，过一段时间再把这个challenge放上来，这会导致认证出问题。
突然来了一个旧的认证包，旧包可能会引发问题，所以咱们的challenge报文中都会包含一个随机数，这个随机数也是每发一次都会改变，由于随机数只有这轮交互是有意义的。
这一轮随机数，对于下一轮的交互是毫无意义，（可以利用时间差来判断，发送方对称加密一个时间，对端对称解密，只要这个时间在3秒以内就放行）
就算这个包被抓了，过段时间再重发，也能轻松判断随机数有问题。把这个包丢弃。

还包含一个主认证方的一个用户名。这个用户名在华为设备可包含可不包含，思科设备一定包含（主机名），
主认证方给被认证方发送challenge，没有携带用户名，被认证方收到challenge以后，它就会拿它接口配置的用户名密码，来给主认证方做一个respones回应。用户名密码也是经过MD5计算过的。
用户名是以明文发送，会话id，随机数都包含，密码信息是结合会话和随机数一并经过md5计算的出的。HMAC。
如果主认证方发送challenge的包含一个认证名，被认证方收到认证方带有用户名的challenge，它会基于这个用户名在它的本地认证数据库查找有没有对应的用户名条目。找到就验证。
